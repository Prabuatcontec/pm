{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-header p-3 pt-2">
              <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                <i class="material-icons opacity-10">weekend</i>
              </div>
              <div class="text-end pt-1">
                <p class="text-sm mb-0 text-capitalize">Today's Money</p>
                <h4 class="mb-0">$53k</h4>
              </div>
            </div>
            <hr class="dark horizontal my-0">
            <div class="card-footer p-3">
              <p class="mb-0"><span class="text-success text-sm font-weight-bolder">+55% </span>than lask week</p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-header p-3 pt-2">
              <div class="icon icon-lg icon-shape bg-gradient-info shadow-info text-center border-radius-xl mt-n4 position-absolute">
                <i class="material-icons opacity-10">person</i>
              </div>
              <div class="text-end pt-1">
                <p class="text-sm mb-0 text-capitalize">Today's Users</p>
                <h4 class="mb-0">2,300</h4>
              </div>
            </div>
            <hr class="dark horizontal my-0">
            <div class="card-footer p-3">
              <p class="mb-0"><span class="text-success text-sm font-weight-bolder">+3% </span>than lask month</p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-header p-3 pt-2">
              <div class="icon icon-lg icon-shape bg-gradient-success shadow-success text-center border-radius-xl mt-n4 position-absolute">
                <i class="material-icons opacity-10">person</i>
              </div>
              <div class="text-end pt-1">
                <p class="text-sm mb-0 text-capitalize">New Clients</p>
                <h4 class="mb-0">3,462</h4>
              </div>
            </div>
            <hr class="dark horizontal my-0">
            <div class="card-footer p-3">
              <p class="mb-0"><span class="text-danger text-sm font-weight-bolder">-2%</span> than yesterday</p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6">
          <div class="card">
            <div class="card-header p-3 pt-2">
              <div class="icon icon-lg icon-shape bg-gradient-info shadow-info text-center border-radius-xl mt-n4 position-absolute">
                <i class="material-icons opacity-10">weekend</i>
              </div>
              <div class="text-end pt-1">
                <p class="text-sm mb-0 text-capitalize">Sales</p>
                <h4 class="mb-0">$103,430</h4>
              </div>
            </div>
            <hr class="dark horizontal my-0">
            <div class="card-footer p-3">
              <p class="mb-0"><span class="text-success text-sm font-weight-bolder">+5% </span>than yesterday</p>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-4">
        <div class="col-lg-6 col-md-6 mt-4 mb-4">
          <div class="card z-index-2 ">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2 bg-transparent">
              <div class="bg-gradient-info shadow-info border-radius-lg py-3 pe-1">
                <div class="chart">
                  <canvas id="chart-bars-shipping" class="chart-canvas" height="250"></canvas>
                </div>
              </div>
            </div>
            <div class="card-body">
              <h6 class="mb-0 ">Operator Activity</h6>
              <p class="text-sm ">Last Campaign Performance</p>
              <hr class="dark horizontal">
              <div class="d-flex ">
                <i class="material-icons text-sm my-auto me-1">schedule</i>
                <p class="mb-0 text-sm"> campaign sent 2 days ago </p>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 col-md-6 mt-4 mb-4">
          <div class="card z-index-2  ">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2 bg-transparent">
              <div class="bg-gradient-success shadow-success border-radius-lg py-3 pe-1">
                <div class="chart">
                  <canvas id="chart-line-shipping" class="chart-canvas" height="250"></canvas>
                </div>
              </div>
            </div>
            <div class="card-body">
              <h6 class="mb-0 "> Daily Sales </h6>
              <p class="text-sm "> (<span class="font-weight-bolder">+15%</span>) increase in today sales. </p>
              <hr class="dark horizontal">
              <div class="d-flex ">
                <i class="material-icons text-sm my-auto me-1">schedule</i>
                <p class="mb-0 text-sm"> updated 4 min ago </p>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="row mt-4">
        <div class="col-lg-6 col-md-6 mt-4 mb-4">
          <div class="card z-index-2 ">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2 bg-transparent">
              <div class="bg-gradient-primary shadow-primary border-radius-lg py-3 pe-1">
                <div class="chart">
                  <canvas id="chart-bars" class="chart-canvas" height="250"></canvas>
                </div>
              </div>
            </div>
            <div class="card-body">
              <h6 class="mb-0 ">Operator Activity</h6>
              <p class="text-sm ">Last Campaign Performance</p>
              <hr class="dark horizontal">
              <div class="d-flex ">
                <i class="material-icons text-sm my-auto me-1">schedule</i>
                <p class="mb-0 text-sm"> campaign sent 2 days ago </p>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 col-md-6 mt-4 mb-4">
          <div class="card z-index-2  ">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2 bg-transparent">
              <div class="bg-gradient-success shadow-success border-radius-lg py-3 pe-1">
                <div class="chart">
                  <canvas id="chart-line" class="chart-canvas" height="250"></canvas>
                </div>
              </div>
            </div>
            <div class="card-body">
              <h6 class="mb-0 "> Daily Sales </h6>
              <p class="text-sm "> (<span class="font-weight-bolder">+15%</span>) increase in today sales. </p>
              <hr class="dark horizontal">
              <div class="d-flex ">
                <i class="material-icons text-sm my-auto me-1">schedule</i>
                <p class="mb-0 text-sm"> updated 4 min ago </p>
              </div>
            </div>
          </div>
        </div>

      </div>


      {% include 'includes/footer.html' %}
    </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

  <script src="/static/assets/js/plugins/chartjs.min.js"></script>
  <script>
   $(document).ready(function () {

<!--   window.setTimeout(function () {-->
<!--  window.location.reload();-->
<!--}, 30000);-->

$.ajax({
type: "GET",
url: "report/box",
data: {},
contentType: "application/json",
dataType: "json",
success: function(response) {

    console.log(response)

    }
    });


$.ajax({
type: "GET",
url: "report",
data: {},
contentType: "application/json",
dataType: "json",
success: function(response) {
    console.log(response)
    var ctx = document.getElementById("chart-bars").getContext("2d");


    var lab = []
    for (var da = 6; da >= 0; da--) {
        var date = new Date();
        date.setDate(date.getDate() - da);

        var finalDate = date.getDate() + '-' + (date.getMonth() + 1) + '-' + date.getFullYear();
        lab.push(finalDate)
    }

    for (so = 0; so <= 6; so++) {
        if (response['result']['time_report_count'][lab[so]] === undefined) {
            response['result']['time_report_count'][lab[so]] = {
                "1-2": 0,
                "2-3": 0,
                "3-5": 0,
                "5-10": 0,
                "10-15": 0,
                "15-60": 0
            };
            response['result']['time_report_hrs'][lab[so]] = {
                "1-2": 0,
                "2-3": 0,
                "3-5": 0,
                "5-10": 0,
                "10-15": 0,
                "15-60": 0
            };
            response['result']['time_report'][lab[so]] = {
                "1-2": 0,
                "2-3": 0,
                "3-5": 0,
                "5-10": 0,
                "10-15": 0,
                "15-60": 0
            };

        }
    }
    console.log(lab)
    console.log(response)


    var dataset = [{
        label: "1-2",
        tension: 0.4,
        borderWidth: 0,
        borderRadius: 1,
        borderSkipped: false,
        backgroundColor: "rgba(200, 105, 255, .8)",
        data: [response['result']['time_report_hrs'][lab[0]]['1-2'], response['result']['time_report_hrs'][lab[1]]['1-2'], response['result']['time_report_hrs'][lab[2]]['1-2'], response['result']['time_report_hrs'][lab[3]]['1-2'], response['result']['time_report_hrs'][lab[4]]['1-2'], response['result']['time_report_hrs'][lab[5]]['1-2']],
        maxBarThickness: 30
    }, {
        label: "2-3",
        tension: 0.4,
        borderWidth: 0,
        borderRadius: 1,
        borderSkipped: false,
        backgroundColor: "rgba(100, 155, 200, .8)",
        data: [response['result']['time_report_hrs'][lab[0]]['2-3'], response['result']['time_report_hrs'][lab[1]]['2-3'], response['result']['time_report_hrs'][lab[2]]['2-3'], response['result']['time_report_hrs'][lab[3]]['2-3'], response['result']['time_report_hrs'][lab[4]]['2-3'], response['result']['time_report_hrs'][lab[5]]['2-3']],
        maxBarThickness: 30
    }, {
        label: "3-5",
        tension: 0.4,
        borderWidth: 0,
        borderRadius: 1,
        borderSkipped: false,
        backgroundColor: "rgba(0, 200, 200, .8)",
        data: [response['result']['time_report_hrs'][lab[0]]['3-5'], response['result']['time_report_hrs'][lab[1]]['3-5'], response['result']['time_report_hrs'][lab[2]]['3-5'], response['result']['time_report_hrs'][lab[3]]['3-5'], response['result']['time_report_hrs'][lab[4]]['3-5'], response['result']['time_report_hrs'][lab[5]]['3-5']],
        maxBarThickness: 30
    }, {
        label: "5-10",
        tension: 0.4,
        borderWidth: 0,
        borderRadius: 1,
        borderSkipped: false,
        backgroundColor: "rgba(204,0,0, .8)",
        data: [response['result']['time_report_hrs'][lab[0]]['5-10'], response['result']['time_report_hrs'][lab[1]]['5-10'], response['result']['time_report_hrs'][lab[2]]['5-10'], response['result']['time_report_hrs'][lab[3]]['5-10'], response['result']['time_report_hrs'][lab[4]]['5-10'], response['result']['time_report_hrs'][lab[5]]['5-10']],
        maxBarThickness: 30
    }, {
        label: "10-15",
        tension: 0.4,
        borderWidth: 1,
        borderRadius: 4,
        borderSkipped: false,
        backgroundColor: "rgba(102,0,51, .8)",
        data: [response['result']['time_report_hrs'][lab[0]]['10-15'], response['result']['time_report_hrs'][lab[1]]['10-15'], response['result']['time_report_hrs'][lab[2]]['10-15'], response['result']['time_report_hrs'][lab[3]]['10-15'], response['result']['time_report_hrs'][lab[4]]['10-15'], response['result']['time_report_hrs'][lab[5]]['10-15']],
        maxBarThickness: 30
    }, {
        label: "15-60",
        tension: 0.4,
        borderWidth: 1,
        borderRadius: 4,
        borderSkipped: false,
        backgroundColor: "rgba(255,153,51, .8)",
        data: [response['result']['time_report_hrs'][lab[0]]['15-60'], response['result']['time_report_hrs'][lab[1]]['15-60'], response['result']['time_report_hrs'][lab[2]]['15-60'], response['result']['time_report_hrs'][lab[3]]['15-60'], response['result']['time_report_hrs'][lab[4]]['15-60'], response['result']['time_report_hrs'][lab[5]]['15-60']],
        maxBarThickness: 30
    }];
    var timedata = new Chart(ctx, {
        type: "bar",
        data: {
            labels: lab,
            datasets: dataset,
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            var label = context.dataset.label || '';

                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                label += parseInt(context.parsed.y) + ' min';
                            }
                            return label;
                        }
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index',
            },
            scales: {
                y: {
                    stacked: true,
                    grid: {
                        drawBorder: false,
                        display: true,
                        drawOnChartArea: true,
                        drawTicks: false,
                        borderDash: [5, 5],
                        color: 'rgba(255, 255, 255, .2)'
                    },
                    ticks: {
                        suggestedMin: 0,
                        suggestedMax: 500,
                        beginAtZero: true,
                        padding: 10,
                        font: {
                            size: 14,
                            weight: 300,
                            family: "Roboto",
                            style: 'normal',
                            lineHeight: 2
                        },
                        color: "#fff",
                        callback: function(label, index, labels) {
                            return label + ' min';

                            // return _label;
                        }
                    },
                },
                x: {
                    stacked: true,
                    grid: {
                        drawBorder: false,
                        display: true,
                        drawOnChartArea: true,
                        drawTicks: false,
                        borderDash: [5, 5],
                        color: 'rgba(255, 255, 255, .2)',

                    },
                    ticks: {
                        display: true,
                        color: '#f8f9fa',
                        padding: 10,
                        font: {
                            size: 14,
                            weight: 300,
                            family: "Roboto",
                            style: 'normal',
                            lineHeight: 2
                        }
                    }
                },
            },
        },
    });
},
});
});






    var ctx2 = document.getElementById("chart-line").getContext("2d");

    new Chart(ctx2, {
      type: "line",
      data: {
        labels: ["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
        datasets: [{
          label: "Mobile apps",
          tension: 0,
          borderWidth: 0,
          pointRadius: 5,
          pointBackgroundColor: "rgba(255, 255, 255, .8)",
          pointBorderColor: "transparent",
          borderColor: "rgba(255, 255, 255, .8)",
          borderColor: "rgba(255, 255, 255, .8)",
          borderWidth: 4,
          backgroundColor: "transparent",
          fill: true,
          data: [50, 40, 300, 320, 500, 350, 200, 230, 500],
          maxBarThickness: 6

        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
          }
        },
        interaction: {
          intersect: false,
          mode: 'index',
        },
        scales: {
          y: {
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: false,
              borderDash: [5, 5],
              color: 'rgba(255, 255, 255, .2)'
            },
            ticks: {
              display: true,
              color: '#f8f9fa',
              padding: 10,
              font: {
                size: 14,
                weight: 300,
                family: "Roboto",
                style: 'normal',
                lineHeight: 2
              },
            }
          },
          x: {
            grid: {
              drawBorder: false,
              display: false,
              drawOnChartArea: false,
              drawTicks: false,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              color: '#f8f9fa',
              padding: 10,
              font: {
                size: 14,
                weight: 300,
                family: "Roboto",
                style: 'normal',
                lineHeight: 2
              },
            }
          },
        },
      },
    });

  </script>

{% endblock javascripts %}
